tinymce.PluginManager.add('imagemanager', function (editor, url) {
    // Add a button that opens a window
    editor.addButton('imagemanager', {
        text: 'Gestionnaire de média',
        icon: 'image',
        onclick: () =>  {
            // Open window
            editor.windowManager.open({
                title: 'Gestionnaire de média',
                url: getUrl(),
                buttons: [{
                    text: 'Valider',
                    onclick: 'submit'
                }, {
                    text: 'Fermer',
                    onclick: 'close'
                }],
                width: 800,
                height: 600,
                onsubmit: function (e) {
                    const imageBoxes = $('iframe').contents().find('#modal-images-container').find('.imagebox.choosed-image');

                    Array.from(imageBoxes).forEach(box => {
                        const url = $(box).find('img').attr('src')
                        if (url.length > 0) {
                            editor.insertContent('<img src="' + url + '" />');
                        }
                        else {
                            alert('something went wrong');
                            return false;
                        }
                    })

                    console.log($('iframe').contents().find('[data-uncheckall]'));


                    $('iframe').contents().find('[data-uncheckall]').click()

                }
            });
        }
    });


});


function getUrl(){
    return `/${tinymce_config.prefix}/media/${btoa(tinymce_config.model_name)}/${tinymce_config.model.id ? tinymce_config.model.id : 0 }/tinymce`
}
